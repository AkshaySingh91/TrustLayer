<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Analysis</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
        button { padding: 10px 20px; margin: 10px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #output { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ðŸ§ª T&C Analysis Test</h1>
    
    <div class="test-section">
        <h2>Backend Response Test</h2>
        <button onclick="testBackendConnection()">Test Backend Connection</button>
        <button onclick="testAnalysisWithMockData()">Test Analysis with Mock Data</button>
    </div>
    
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
        }
        
        async function testBackendConnection() {
            log('ðŸ”— Testing backend connection...');
            
            try {
                const response = await fetch('http://localhost:8000/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… Backend connected: ${JSON.stringify(data)}`);
                } else {
                    log(`âŒ Backend connection failed: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                log(`âŒ Backend connection error: ${error.message}`);
                
                // Try port 8001
                try {
                    const response = await fetch('http://localhost:8001/', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        log(`âœ… Backend connected on port 8001: ${JSON.stringify(data)}`);
                    } else {
                        log(`âŒ Backend on port 8001 also failed`);
                    }
                } catch (error2) {
                    log(`âŒ No backend found on 8000 or 8001`);
                }
            }
        }
        
        async function testAnalysisWithMockData() {
            log('ðŸ§ª Testing analysis with mock data...');
            
            const mockRequest = {
                text: "This privacy policy describes how we collect, use, and share your personal information. We may collect your email address, location data, and device information. We use this data for advertising and analytics purposes. We may share your information with third parties. You have the right to delete your data and opt-out of marketing. We are not responsible for any damages. This agreement automatically renews unless cancelled.",
                language: "en"
            };
            
            try {
                const response = await fetch('http://localhost:8000/analyze_text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(mockRequest)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… Analysis successful!`);
                    log(`ðŸ“Š Summary: ${data.summary?.executive_summary?.substring(0, 100)}...`);
                    log(`âš ï¸ Risk Level: ${data.risk_analysis?.risk_level}`);
                    log(`ðŸ” Enhanced Analysis Available: ${data.summary?.enhanced_analysis ? 'Yes' : 'No'}`);
                    
                    if (data.summary?.enhanced_analysis) {
                        const enhanced = data.summary.enhanced_analysis;
                        log(`ðŸ“„ Summary Key Points: ${enhanced.summary_key_points ? 'Available' : 'Missing'}`);
                        log(`ðŸ“Š Data Collected: ${enhanced.data_collected ? 'Available' : 'Missing'}`);
                        log(`ðŸŽ¯ Data Usage: ${enhanced.data_usage ? 'Available' : 'Missing'}`);
                        log(`ðŸ”— Data Sharing: ${enhanced.data_sharing ? 'Available' : 'Missing'}`);
                        log(`âš–ï¸ User Rights: ${enhanced.user_rights ? 'Available' : 'Missing'}`);
                        log(`âš ï¸ Liabilities: ${enhanced.liabilities ? 'Available' : 'Missing'}`);
                        log(`ðŸ”„ Auto Renewals: ${enhanced.automatic_renewals ? 'Available' : 'Missing'}`);
                        log(`ðŸšª Termination: ${enhanced.termination_clauses ? 'Available' : 'Missing'}`);
                        log(`ðŸ“ˆ Risk Breakdown: ${enhanced.risk_score_breakdown ? 'Available' : 'Missing'}`);
                    } else {
                        log(`âŒ Enhanced analysis not found in response`);
                        log(`ðŸ” Full response structure: ${JSON.stringify(Object.keys(data), null, 2)}`);
                    }
                } else {
                    log(`âŒ Analysis failed: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                log(`âŒ Analysis error: ${error.message}`);
            }
        }
        
        // Auto-test on load
        setTimeout(() => {
            log('ðŸš€ Starting automatic tests...');
            testBackendConnection();
        }, 1000);
    </script>
</body>
</html>